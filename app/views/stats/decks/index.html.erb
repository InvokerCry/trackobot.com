<%= profile_page 'Deck Statistics', json: true do %>
  <div class="row">
    <div class="col-sm-4">
      <h3>Deck Statistics</h3>
    </div>
    <div class="col-sm-8">
      <h3>
        <%= render partial: '/stats/shared/toolbar', locals: { modes: %i[ranked casual friendly] } %>
      </h3>
    </div>
  </div>

  <%= render partial: '/layouts/notifications' %>

  <%= render(partial: '/layouts/filter', locals: {name: 'As', label: label_for_deck(@as_deck), param: :as_deck}) if @as_deck %>
  <%= render(partial: '/layouts/filter', locals: {name: 'Versus', label: label_for_deck(@vs_deck), param: :vs_deck}) if @vs_deck %>

  <table class="table table-hover table-condensed stats overall-stats">
    <thead>
      <tr>
        <th class="win-loss">Win - Loss</th>
        <th class="winrate">Winrate</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="win-loss"><%= @stats[:overall][:wins] %> - <%= @stats[:overall][:losses] %></td>
        <td class="winrate"><%= winrate(@stats[:overall][:wins], @stats[:overall][:losses]) %>
        </td>
      </tr>
    </tbody>
  </table>

  <% if current_user.decks.empty? %>
  <p class="alert alert-info">
    No decks defined. Define decks in the <%= link_to 'settings', profile_settings_decks_path %>.
  </p>
  <% else %>
  <%
    %i[as vs].each do |type| 
      key = "#{type}_deck".to_sym
      next if instance_variable_get("@#{type}_deck")
  %>
      <table class="table table-hover table-condensed stats deck-stats">
        <thead>
          <tr>
            <th class="deck">Deck</th>
            <th class="share"><%= sortable_header_link('% Overall', :share) %></th>
            <th class="win-loss">Win/Loss</th>
            <th class="winrate"><%= sortable_header_link('Winrate', :winrate) %></th>
          </tr>
        </thead>
        <tbody>

        <% @stats[key].each do |deck, stats| %>
        <tr>
          <td class="deck"><%= type %> <%= link_to label_for_deck(deck), params.merge("#{type}_deck" => deck.id) %></td>
          <td class="share"><%= percentage(stats[:wins] + stats[:losses], @stats[:overall][:total]) %></td>
          <td class="win-loss"><%= stats[:wins] %>/<%= stats[:losses] %></td>
          <td class="winrate"><%= winrate(stats[:wins], stats[:losses]) %></td>
        </tr>
        <% end %>
      </table>
    <% end %>
  <% end %>
<% end %>
