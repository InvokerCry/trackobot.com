<h2>Arena Statistics</h2>

<%
  total_arena_runs = @stats[:arena].inject(0) do |sum, (num_wins, count_per_hero)|
    sum + count_per_hero.values.inject(&:+)
  end
  total_wins = @stats[:arena].inject(0) do |sum, (num_wins, count_per_hero)|
    sum + num_wins * count_per_hero.values.inject(&:+)
  end
%>

<table class="table table-hover table-condensed arena-stats">
  <thead>
    <tr>
      <th class="wins">Wins</th>
      <th class="achieved">Achieved</th>
      <th class="share">Share</th>
      <th class="hero">Class</th>
    </tr>
  </thead>
  <tbody>

  <% @stats[:arena].each do |num_wins, count_per_hero| %>
  <tr>
    <td class="wins"><%= num_wins %></td>
    <td class="achieved"><%= 
      times_achieved = count_per_hero.values.inject(&:+) 
      "#{times_achieved}x"
    %></td>
    <td class="share">
      <%= percentage( times_achieved, total_arena_runs ) %>
    </td>
    <td class="hero">
      <%=
        count_per_hero.collect do |hero_name, count|
          hero_icon(hero_name, {data: {toggle: 'tooltip', placement: 'bottom'}, title: "#{count}x with #{hero_name}", class: 'has-tooltip'})
        end.join.html_safe
      %>
    </td>
  </tr>
  <% end %>
</table>

<table class="table table-hover table-condensed arena-stats">
  <thead>
    <tr>
      <th class="total-wins">Total wins</th>
      <th class="total-arenas">Total arenas</th>
      <th class="wins-average">Wins on average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="total-wins"><%= total_wins %></td>
      <td class="total-arenas"><%= total_arena_runs %></td>
      <td class="wins-average"><%= total_arena_runs == 0 ? '-' : "%.1f" % (total_wins.to_f / total_arena_runs) %></td>
    </tr>
  </tbody>
</table>


